<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ELARA CORE // Speed Test</title>
    <meta name="description" content="How fast can you type Elara MCP tool commands? Test your speed in a cyberpunk terminal.">
    <meta property="og:title" content="Elara Core â€” Typing Speed Test">
    <meta property="og:description" content="Type MCP tool commands as fast as you can. 10 rounds. Are you an INTERN or ELARA HERSELF?">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://elara.navigatorbuilds.com/speed.html">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@NavigatorBuilds">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Share+Tech+Mono&family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0a;
            --bg-card: #0f0f0f;
            --bg-terminal: #050505;
            --green: #00ff41;
            --green-dim: #00cc33;
            --green-dark: #003300;
            --red: #ff0040;
            --cyan: #00e5ff;
            --amber: #ffb000;
            --text: #c0c0c0;
            --text-dim: #606060;
            --text-bright: #e0e0e0;
            --border: #1a1a1a;
            --border-green: #003300;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Share Tech Mono', monospace;
            background: var(--bg);
            color: var(--text);
            line-height: 1.7;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* CRT Scanlines */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 9999;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.08) 2px, rgba(0,0,0,0.08) 4px);
        }

        /* Vignette */
        body::after {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 9998;
            background: radial-gradient(ellipse at center, transparent 60%, rgba(0,0,0,0.35) 100%);
        }

        /* Scanline sweep */
        .scanline-sweep {
            position: fixed;
            top: -4px;
            left: 0; right: 0;
            height: 4px;
            background: linear-gradient(180deg, transparent, rgba(0,255,65,0.12), transparent);
            z-index: 9997;
            pointer-events: none;
            animation: scanline-pass 4s linear infinite;
        }

        @keyframes scanline-pass {
            0%   { top: -4px; }
            100% { top: 100%; }
        }

        @keyframes flicker {
            0%   { opacity: 1; }
            3%   { opacity: 0.96; }
            6%   { opacity: 1; }
            50%  { opacity: 1; }
            51%  { opacity: 0.93; }
            52%  { opacity: 1; }
            89%  { opacity: 1; }
            90%  { opacity: 0.97; }
            91%  { opacity: 1; }
            100% { opacity: 1; }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(0,255,65,0.2); }
            50% { box-shadow: 0 0 20px rgba(0,255,65,0.4), 0 0 40px rgba(0,255,65,0.1); }
        }

        @keyframes glitch-in {
            0%   { text-shadow: 2px 0 var(--red), -2px 0 var(--cyan); transform: skew(-1deg); }
            20%  { text-shadow: -2px 0 var(--red), 2px 0 var(--cyan); transform: skew(0.5deg); }
            40%  { text-shadow: 1px 1px var(--red), -1px -1px var(--cyan); transform: skew(-0.3deg); }
            60%  { text-shadow: -1px 0 var(--red), 1px 0 var(--cyan); transform: skew(0.1deg); }
            80%  { text-shadow: 0 0 var(--red), 0 0 var(--cyan); transform: skew(0deg); }
            100% { text-shadow: none; transform: skew(0deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10% { transform: translateX(-4px); }
            20% { transform: translateX(4px); }
            30% { transform: translateX(-3px); }
            40% { transform: translateX(3px); }
            50% { transform: translateX(-2px); }
            60% { transform: translateX(2px); }
            70% { transform: translateX(-1px); }
            80% { transform: translateX(1px); }
        }

        @keyframes green-pulse {
            0% { background: rgba(0,255,65,0.15); }
            100% { background: transparent; }
        }

        @keyframes score-reveal {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes rating-glitch {
            0%   { text-shadow: 3px 0 var(--red), -3px 0 var(--cyan); transform: skew(-2deg); opacity: 0; }
            20%  { text-shadow: -3px 0 var(--red), 3px 0 var(--cyan); transform: skew(1deg); opacity: 0.5; }
            40%  { text-shadow: 2px 1px var(--red), -2px -1px var(--cyan); transform: skew(-0.5deg); opacity: 0.8; }
            60%  { text-shadow: -1px 0 var(--red), 1px 0 var(--cyan); transform: skew(0.2deg); opacity: 0.9; }
            80%  { text-shadow: 0 0 var(--red), 0 0 var(--cyan); transform: skew(0deg); opacity: 1; }
            100% { text-shadow: none; transform: skew(0deg); opacity: 1; }
        }

        @keyframes streak-pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 24px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            padding: 40px 0 20px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 30px;
        }

        .header-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header-nav a {
            font-family: 'Share Tech Mono', monospace;
            font-size: 13px;
            color: var(--green-dim);
            text-decoration: none;
            letter-spacing: 1px;
            transition: all 0.2s;
        }

        .header-nav a:hover {
            color: var(--green);
            text-shadow: 0 0 8px rgba(0,255,65,0.4);
        }

        .header-nav .logo {
            font-family: 'Press Start 2P', monospace;
            font-size: 11px;
            color: var(--green);
            text-shadow: 0 0 15px rgba(0,255,65,0.5);
        }

        .header-nav .logo .red { color: var(--red); text-shadow: 0 0 10px rgba(255,0,64,0.5); }

        h1 {
            font-family: 'Press Start 2P', monospace;
            font-size: 18px;
            color: var(--green);
            text-shadow: 0 0 20px rgba(0,255,65,0.4);
            margin-bottom: 12px;
            animation: glitch-in 0.5s ease-out;
        }

        .subtitle {
            color: var(--text-dim);
            font-size: 13px;
            letter-spacing: 1px;
        }

        .subtitle .green { color: var(--green-dim); }

        /* Terminal frame */
        .terminal-frame {
            background: var(--bg-terminal);
            border: 1px solid var(--border-green);
            border-radius: 4px;
            margin-bottom: 30px;
            animation: flicker 6s infinite;
            box-shadow:
                0 0 30px rgba(0,255,65,0.05),
                inset 0 0 60px rgba(0,0,0,0.4);
        }

        .terminal-titlebar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: #0a0a0a;
            border-bottom: 1px solid var(--border);
            border-radius: 4px 4px 0 0;
        }

        .terminal-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--text-dim);
        }

        .terminal-dot.r { background: var(--red); box-shadow: 0 0 6px rgba(255,0,64,0.5); }
        .terminal-dot.y { background: var(--amber); box-shadow: 0 0 6px rgba(255,176,0,0.5); }
        .terminal-dot.g { background: var(--green); box-shadow: 0 0 6px rgba(0,255,65,0.5); }

        .terminal-title {
            flex: 1;
            text-align: center;
            font-size: 11px;
            color: var(--text-dim);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .terminal-body {
            padding: 24px;
            min-height: 420px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* HUD Stats Bar */
        .hud {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            background: #080808;
            font-size: 12px;
            letter-spacing: 1px;
        }

        .hud-left, .hud-right {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .hud-stat {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .hud-label {
            color: var(--text-dim);
            text-transform: uppercase;
            font-size: 10px;
        }

        .hud-value {
            color: var(--green);
            font-family: 'VT323', monospace;
            font-size: 18px;
            min-width: 30px;
            text-align: right;
        }

        .hud-value.timer {
            color: var(--cyan);
            min-width: 60px;
        }

        .hud-value.streak {
            color: var(--amber);
            transition: transform 0.15s;
        }

        .hud-value.streak.pop {
            animation: streak-pop 0.2s ease-out;
        }

        .hud-value.wpm {
            color: var(--green);
        }

        /* Progress bar */
        .progress-container {
            width: 100%;
            padding: 0 16px 12px;
            background: #080808;
            border-bottom: 1px solid var(--border);
        }

        .progress-bar-track {
            width: 100%;
            height: 3px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--green);
            box-shadow: 0 0 8px rgba(0,255,65,0.5);
            border-radius: 2px;
            transition: width 0.4s ease-out;
            width: 0%;
        }

        /* Start screen */
        .start-screen {
            text-align: center;
        }

        .start-title {
            font-family: 'Press Start 2P', monospace;
            font-size: 14px;
            color: var(--green);
            text-shadow: 0 0 15px rgba(0,255,65,0.4);
            margin-bottom: 20px;
        }

        .start-desc {
            color: var(--text-dim);
            font-size: 13px;
            margin-bottom: 8px;
            line-height: 1.8;
        }

        .start-desc .green { color: var(--green-dim); }
        .start-desc .amber { color: var(--amber); }
        .start-desc .cyan { color: var(--cyan); }

        .start-btn {
            display: inline-block;
            margin-top: 24px;
            padding: 12px 32px;
            background: transparent;
            border: 1px solid var(--green);
            color: var(--green);
            font-family: 'Press Start 2P', monospace;
            font-size: 12px;
            cursor: pointer;
            letter-spacing: 2px;
            transition: all 0.3s;
            text-transform: uppercase;
            animation: pulse-glow 2s infinite;
        }

        .start-btn:hover {
            background: rgba(0,255,65,0.1);
            box-shadow: 0 0 25px rgba(0,255,65,0.3);
            text-shadow: 0 0 10px rgba(0,255,65,0.5);
        }

        .start-btn:active {
            background: rgba(0,255,65,0.2);
        }

        /* Game screen */
        .game-screen {
            width: 100%;
            display: none;
        }

        .round-label {
            font-family: 'VT323', monospace;
            font-size: 16px;
            color: var(--text-dim);
            text-align: center;
            margin-bottom: 8px;
            letter-spacing: 2px;
        }

        .command-display {
            width: 100%;
            padding: 20px;
            margin-bottom: 16px;
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .command-chars {
            font-family: 'Share Tech Mono', monospace;
            font-size: 18px;
            letter-spacing: 0.5px;
            line-height: 1.6;
            word-break: break-all;
        }

        .command-chars .char {
            transition: color 0.05s, text-shadow 0.05s;
        }

        .command-chars .char.correct {
            color: var(--green);
            text-shadow: 0 0 6px rgba(0,255,65,0.4);
        }

        .command-chars .char.incorrect {
            color: var(--red);
            text-shadow: 0 0 6px rgba(255,0,64,0.4);
            text-decoration: underline;
        }

        .command-chars .char.current {
            color: var(--text-bright);
            background: rgba(0,255,65,0.1);
            border-bottom: 2px solid var(--green);
        }

        .command-chars .char.pending {
            color: var(--text-dim);
        }

        /* Input area */
        .type-area {
            width: 100%;
            position: relative;
        }

        .type-input-row {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border: 1px solid var(--border-green);
            background: rgba(0,255,65,0.02);
            border-radius: 3px;
            transition: border-color 0.2s, background 0.2s;
        }

        .type-input-row.correct-flash {
            animation: green-pulse 0.3s ease-out;
        }

        .type-input-row.error-shake {
            animation: shake 0.3s ease-out;
            border-color: var(--red);
        }

        .type-input-row:focus-within {
            border-color: var(--green-dim);
            box-shadow: 0 0 15px rgba(0,255,65,0.1);
        }

        .prompt-char {
            color: var(--green);
            margin-right: 8px;
            font-weight: bold;
            text-shadow: 0 0 8px rgba(0,255,65,0.5);
            flex-shrink: 0;
            font-size: 16px;
        }

        .type-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-bright);
            font-family: 'Share Tech Mono', monospace;
            font-size: 16px;
            caret-color: var(--green);
        }

        .type-input::placeholder {
            color: var(--text-dim);
            opacity: 0.4;
        }

        /* Results screen */
        .results-screen {
            display: none;
            text-align: center;
            width: 100%;
        }

        .results-box {
            border: 1px solid var(--border-green);
            padding: 30px;
            margin-bottom: 24px;
            animation: score-reveal 0.5s ease-out;
        }

        .results-title {
            font-family: 'Press Start 2P', monospace;
            font-size: 14px;
            color: var(--green);
            text-shadow: 0 0 15px rgba(0,255,65,0.4);
            margin-bottom: 24px;
        }

        .results-rating {
            font-family: 'Press Start 2P', monospace;
            font-size: 20px;
            margin-bottom: 24px;
            animation: rating-glitch 0.8s ease-out;
        }

        .results-rating.intern { color: var(--text-dim); }
        .results-rating.developer { color: var(--amber); text-shadow: 0 0 15px rgba(255,176,0,0.4); }
        .results-rating.senior { color: var(--cyan); text-shadow: 0 0 15px rgba(0,229,255,0.4); }
        .results-rating.elara { color: var(--green); text-shadow: 0 0 20px rgba(0,255,65,0.6); }

        .results-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .result-stat {
            padding: 12px;
            border: 1px solid var(--border);
            background: rgba(0,0,0,0.3);
        }

        .result-stat-label {
            font-size: 10px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 6px;
        }

        .result-stat-value {
            font-family: 'VT323', monospace;
            font-size: 28px;
            color: var(--green);
        }

        .result-stat-value.time { color: var(--cyan); }
        .result-stat-value.accuracy { color: var(--amber); }

        .result-per-command {
            margin-top: 20px;
            text-align: left;
            border-top: 1px solid var(--border);
            padding-top: 16px;
        }

        .result-per-command-title {
            font-size: 11px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .result-cmd-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            border-bottom: 1px solid #111;
            font-size: 12px;
        }

        .result-cmd-name {
            color: var(--text-dim);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 55%;
        }

        .result-cmd-stats {
            display: flex;
            gap: 12px;
        }

        .result-cmd-time { color: var(--cyan); }
        .result-cmd-acc { color: var(--amber); }

        .retry-btn {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 32px;
            background: transparent;
            border: 1px solid var(--green);
            color: var(--green);
            font-family: 'Press Start 2P', monospace;
            font-size: 11px;
            cursor: pointer;
            letter-spacing: 2px;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .retry-btn:hover {
            background: rgba(0,255,65,0.1);
            box-shadow: 0 0 25px rgba(0,255,65,0.3);
            text-shadow: 0 0 10px rgba(0,255,65,0.5);
        }

        /* Countdown overlay */
        .countdown {
            display: none;
            font-family: 'Press Start 2P', monospace;
            font-size: 48px;
            color: var(--green);
            text-shadow: 0 0 30px rgba(0,255,65,0.6);
            text-align: center;
        }

        .countdown.active {
            display: block;
            animation: score-reveal 0.3s ease-out;
        }

        /* Footer */
        .footer {
            padding: 30px 0;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-dim);
            font-size: 12px;
        }

        .footer a {
            color: var(--green-dim);
            text-decoration: none;
        }

        .footer a:hover {
            color: var(--green);
            text-shadow: 0 0 8px rgba(0,255,65,0.4);
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 13px; }
            .command-chars { font-size: 14px; }
            .type-input { font-size: 14px; }
            .hud { flex-direction: column; gap: 8px; }
            .hud-left, .hud-right { gap: 12px; }
            .results-stats { grid-template-columns: 1fr; }
            .result-cmd-row { font-size: 11px; }
            .start-title { font-size: 11px; }
        }

        @media (max-width: 480px) {
            .command-chars { font-size: 12px; }
            .type-input { font-size: 13px; }
            .terminal-body { padding: 16px; min-height: 320px; }
        }
    </style>
</head>
<body>

    <div class="scanline-sweep"></div>

    <div class="container">

        <!-- Header -->
        <div class="header">
            <div class="header-nav">
                <a href="/" class="logo">ELARA<span class="red">/</span>CORE</a>
                <div>
                    <a href="/">HOME</a> &nbsp;|&nbsp;
                    <a href="/playground.html">PLAY</a> &nbsp;|&nbsp;
                    <a href="/tools.html">TOOLS</a> &nbsp;|&nbsp;
                    <a href="https://github.com/aivelikivodja-bot/elara-core" target="_blank" rel="noopener">SRC</a>
                </div>
            </div>
            <h1>> SPEED TEST</h1>
            <p class="subtitle">Type MCP tool commands as fast as you can &mdash; <span class="green">10 rounds</span></p>
        </div>

        <!-- Terminal -->
        <div class="terminal-frame">
            <div class="terminal-titlebar">
                <div class="terminal-dot r"></div>
                <div class="terminal-dot y"></div>
                <div class="terminal-dot g"></div>
                <div class="terminal-title">elara-speedtest // terminal</div>
            </div>

            <!-- HUD -->
            <div class="hud" id="hud" style="display:none;">
                <div class="hud-left">
                    <div class="hud-stat">
                        <span class="hud-label">Time</span>
                        <span class="hud-value timer" id="hudTimer">0.0s</span>
                    </div>
                    <div class="hud-stat">
                        <span class="hud-label">WPM</span>
                        <span class="hud-value wpm" id="hudWpm">0</span>
                    </div>
                </div>
                <div class="hud-right">
                    <div class="hud-stat">
                        <span class="hud-label">Streak</span>
                        <span class="hud-value streak" id="hudStreak">0</span>
                    </div>
                    <div class="hud-stat">
                        <span class="hud-label">Round</span>
                        <span class="hud-value" id="hudRound">1/10</span>
                    </div>
                </div>
            </div>

            <!-- Progress bar -->
            <div class="progress-container" id="progressContainer" style="display:none;">
                <div class="progress-bar-track">
                    <div class="progress-bar-fill" id="progressFill"></div>
                </div>
            </div>

            <div class="terminal-body">

                <!-- Start Screen -->
                <div class="start-screen" id="startScreen">
                    <div class="start-title">TYPING SPEED TEST</div>
                    <p class="start-desc">Type <span class="green">10 Elara MCP tool commands</span> as fast as you can.</p>
                    <p class="start-desc">Characters turn <span class="green">green</span> when correct, <span style="color:var(--red)">red</span> when wrong.</p>
                    <p class="start-desc">Difficulty increases with each round.</p>
                    <p class="start-desc" style="margin-top:12px;">
                        <span class="amber">&lt;30 WPM</span> = INTERN &nbsp;&bull;&nbsp;
                        <span class="amber">30-50</span> = DEVELOPER<br>
                        <span class="cyan">50-70</span> = SENIOR &nbsp;&bull;&nbsp;
                        <span class="green">70+</span> = ELARA HERSELF
                    </p>
                    <button class="start-btn" id="startBtn">START TEST</button>
                </div>

                <!-- Countdown -->
                <div class="countdown" id="countdown"></div>

                <!-- Game Screen -->
                <div class="game-screen" id="gameScreen">
                    <div class="round-label" id="roundLabel">ROUND 1 / 10</div>
                    <div class="command-display">
                        <div class="command-chars" id="commandChars"></div>
                    </div>
                    <div class="type-area">
                        <div class="type-input-row" id="typeInputRow">
                            <span class="prompt-char">></span>
                            <input type="text" class="type-input" id="typeInput" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" placeholder="start typing...">
                        </div>
                    </div>
                </div>

                <!-- Results Screen -->
                <div class="results-screen" id="resultsScreen">
                    <div class="results-box">
                        <div class="results-title">TEST COMPLETE</div>
                        <div class="results-rating" id="resultsRating"></div>
                        <div class="results-stats">
                            <div class="result-stat">
                                <div class="result-stat-label">Total Time</div>
                                <div class="result-stat-value time" id="resultTime"></div>
                            </div>
                            <div class="result-stat">
                                <div class="result-stat-label">Words / Min</div>
                                <div class="result-stat-value" id="resultWpm"></div>
                            </div>
                            <div class="result-stat">
                                <div class="result-stat-label">Accuracy</div>
                                <div class="result-stat-value accuracy" id="resultAccuracy"></div>
                            </div>
                            <div class="result-stat">
                                <div class="result-stat-label">Best Streak</div>
                                <div class="result-stat-value" id="resultStreak" style="color:var(--amber)"></div>
                            </div>
                        </div>
                        <div class="result-per-command">
                            <div class="result-per-command-title">Per Command Breakdown</div>
                            <div id="resultBreakdown"></div>
                        </div>
                    </div>
                    <button class="retry-btn" id="retryBtn">TRY AGAIN</button>
                </div>

            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <a href="/">ELARA CORE</a> &mdash; Persistent memory for AI &mdash;
            <a href="https://github.com/aivelikivodja-bot/elara-core" target="_blank" rel="noopener">GitHub</a>
        </div>

    </div>

    <script>
    (function() {
        'use strict';

        // ---- Commands (increasing difficulty) ----
        const COMMANDS = [
            'elara_mood()',
            'elara_recall("bug")',
            'elara_status()',
            'elara_remember("test")',
            'elara_mood_adjust(valence=0.1)',
            'elara_episode_start(session_type="work")',
            'elara_correction(action="check", task="query")',
            'elara_dream(dream_type="weekly")',
            'elara_episode_note(event="milestone reached")',
            'elara_business(action="idea", name="cool project")',
        ];

        // ---- DOM ----
        const startScreen = document.getElementById('startScreen');
        const startBtn = document.getElementById('startBtn');
        const countdownEl = document.getElementById('countdown');
        const gameScreen = document.getElementById('gameScreen');
        const resultsScreen = document.getElementById('resultsScreen');
        const hud = document.getElementById('hud');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const hudTimer = document.getElementById('hudTimer');
        const hudWpm = document.getElementById('hudWpm');
        const hudStreak = document.getElementById('hudStreak');
        const hudRound = document.getElementById('hudRound');
        const roundLabel = document.getElementById('roundLabel');
        const commandChars = document.getElementById('commandChars');
        const typeInput = document.getElementById('typeInput');
        const typeInputRow = document.getElementById('typeInputRow');
        const resultsRating = document.getElementById('resultsRating');
        const resultTime = document.getElementById('resultTime');
        const resultWpm = document.getElementById('resultWpm');
        const resultAccuracy = document.getElementById('resultAccuracy');
        const resultStreak = document.getElementById('resultStreak');
        const resultBreakdown = document.getElementById('resultBreakdown');
        const retryBtn = document.getElementById('retryBtn');

        // ---- State ----
        let currentRound = 0;
        let totalStartTime = 0;
        let roundStartTime = 0;
        let timerInterval = null;
        let streak = 0;
        let bestStreak = 0;
        let totalCorrectChars = 0;
        let totalTypedChars = 0;
        let roundResults = []; // { cmd, time, correct, total }

        // ---- Start ----
        startBtn.addEventListener('click', startCountdown);
        retryBtn.addEventListener('click', resetGame);

        function startCountdown() {
            startScreen.style.display = 'none';
            countdownEl.style.display = 'block';
            countdownEl.classList.add('active');

            let count = 3;
            countdownEl.textContent = count;

            const interval = setInterval(function() {
                count--;
                if (count > 0) {
                    countdownEl.textContent = count;
                    countdownEl.classList.remove('active');
                    void countdownEl.offsetWidth; // force reflow
                    countdownEl.classList.add('active');
                } else {
                    clearInterval(interval);
                    countdownEl.style.display = 'none';
                    countdownEl.classList.remove('active');
                    startGame();
                }
            }, 700);
        }

        function startGame() {
            currentRound = 0;
            totalCorrectChars = 0;
            totalTypedChars = 0;
            streak = 0;
            bestStreak = 0;
            roundResults = [];

            hud.style.display = 'flex';
            progressContainer.style.display = 'block';
            gameScreen.style.display = 'block';
            resultsScreen.style.display = 'none';

            totalStartTime = performance.now();
            startTimer();
            loadRound(0);
        }

        function loadRound(idx) {
            currentRound = idx;
            const cmd = COMMANDS[idx];

            // Update HUD
            hudRound.textContent = (idx + 1) + '/10';
            roundLabel.textContent = 'ROUND ' + (idx + 1) + ' / 10';
            progressFill.style.width = ((idx) / 10 * 100) + '%';

            // Render command characters
            commandChars.innerHTML = '';
            for (let i = 0; i < cmd.length; i++) {
                const span = document.createElement('span');
                span.className = 'char ' + (i === 0 ? 'current' : 'pending');
                span.textContent = cmd[i];
                span.dataset.index = i;
                commandChars.appendChild(span);
            }

            // Reset input
            typeInput.value = '';
            typeInput.placeholder = 'start typing...';
            typeInput.focus();

            // Round timer
            roundStartTime = performance.now();
        }

        // ---- Timer ----
        function startTimer() {
            timerInterval = setInterval(function() {
                const elapsed = (performance.now() - totalStartTime) / 1000;
                hudTimer.textContent = elapsed.toFixed(1) + 's';

                // Live WPM: (chars typed / 5) / minutes elapsed
                if (elapsed > 0.5) {
                    const minutes = elapsed / 60;
                    const words = totalCorrectChars / 5;
                    const wpm = Math.round(words / minutes);
                    hudWpm.textContent = wpm > 0 ? wpm : '0';
                }
            }, 100);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // ---- Input handling ----
        typeInput.addEventListener('input', function() {
            const cmd = COMMANDS[currentRound];
            const typed = typeInput.value;
            const chars = commandChars.querySelectorAll('.char');
            let roundCorrect = 0;
            let hasError = false;

            for (let i = 0; i < cmd.length; i++) {
                const charEl = chars[i];
                if (i < typed.length) {
                    if (typed[i] === cmd[i]) {
                        charEl.className = 'char correct';
                        roundCorrect++;
                    } else {
                        charEl.className = 'char incorrect';
                        hasError = true;
                    }
                } else if (i === typed.length) {
                    charEl.className = 'char current';
                } else {
                    charEl.className = 'char pending';
                }
            }

            // Update streak
            if (typed.length > 0) {
                const lastChar = typed[typed.length - 1];
                const expectedChar = cmd[typed.length - 1];
                if (lastChar === expectedChar) {
                    streak++;
                    if (streak > bestStreak) bestStreak = streak;
                    hudStreak.textContent = streak;
                    hudStreak.classList.remove('pop');
                    void hudStreak.offsetWidth;
                    hudStreak.classList.add('pop');
                } else {
                    streak = 0;
                    hudStreak.textContent = '0';

                    // Shake on error
                    typeInputRow.classList.remove('error-shake');
                    void typeInputRow.offsetWidth;
                    typeInputRow.classList.add('error-shake');
                }
            }

            // Check if command is complete
            if (typed.length === cmd.length) {
                const roundTime = (performance.now() - roundStartTime) / 1000;

                // Count correct/total for this round
                let rc = 0;
                for (let i = 0; i < cmd.length; i++) {
                    if (typed[i] === cmd[i]) rc++;
                }

                totalCorrectChars += rc;
                totalTypedChars += cmd.length;

                roundResults.push({
                    cmd: cmd,
                    time: roundTime,
                    correct: rc,
                    total: cmd.length
                });

                // Green pulse
                typeInputRow.classList.remove('correct-flash', 'error-shake');
                void typeInputRow.offsetWidth;
                typeInputRow.classList.add('correct-flash');

                // Next round or finish
                if (currentRound < COMMANDS.length - 1) {
                    setTimeout(function() {
                        loadRound(currentRound + 1);
                    }, 300);
                } else {
                    // Update progress to full
                    progressFill.style.width = '100%';
                    setTimeout(finishGame, 400);
                }
            }
        });

        // Prevent tab, arrow keys from messing with input
        typeInput.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') {
                e.preventDefault();
            }
        });

        // ---- Finish ----
        function finishGame() {
            stopTimer();
            const totalTime = (performance.now() - totalStartTime) / 1000;
            const totalMinutes = totalTime / 60;
            const totalWords = totalCorrectChars / 5;
            const wpm = Math.round(totalWords / totalMinutes);
            const accuracy = totalTypedChars > 0 ? Math.round((totalCorrectChars / totalTypedChars) * 100) : 0;

            // Rating
            let rating, ratingClass;
            if (wpm >= 70) {
                rating = 'ELARA HERSELF';
                ratingClass = 'elara';
            } else if (wpm >= 50) {
                rating = 'SENIOR';
                ratingClass = 'senior';
            } else if (wpm >= 30) {
                rating = 'DEVELOPER';
                ratingClass = 'developer';
            } else {
                rating = 'INTERN';
                ratingClass = 'intern';
            }

            // Hide game, show results
            gameScreen.style.display = 'none';
            hud.style.display = 'none';
            progressContainer.style.display = 'none';
            resultsScreen.style.display = 'block';

            resultsRating.textContent = rating;
            resultsRating.className = 'results-rating ' + ratingClass;
            resultTime.textContent = totalTime.toFixed(1) + 's';
            resultWpm.textContent = wpm;
            resultAccuracy.textContent = accuracy + '%';
            resultStreak.textContent = bestStreak;

            // Per-command breakdown
            resultBreakdown.innerHTML = '';
            for (const r of roundResults) {
                const acc = Math.round((r.correct / r.total) * 100);
                const row = document.createElement('div');
                row.className = 'result-cmd-row';

                // Truncate long command names for display
                let displayCmd = r.cmd;
                if (displayCmd.length > 40) {
                    displayCmd = displayCmd.substring(0, 37) + '...';
                }

                row.innerHTML =
                    '<span class="result-cmd-name">' + escapeHTML(displayCmd) + '</span>' +
                    '<span class="result-cmd-stats">' +
                    '<span class="result-cmd-time">' + r.time.toFixed(1) + 's</span>' +
                    '<span class="result-cmd-acc">' + acc + '%</span>' +
                    '</span>';
                resultBreakdown.appendChild(row);
            }
        }

        // ---- Reset ----
        function resetGame() {
            resultsScreen.style.display = 'none';
            startScreen.style.display = 'block';
            hudTimer.textContent = '0.0s';
            hudWpm.textContent = '0';
            hudStreak.textContent = '0';
            progressFill.style.width = '0%';
        }

        // ---- Utilities ----
        function escapeHTML(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

    })();
    </script>

</body>
</html>
